<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>BTS: Army Puzzle Challenge</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Fredoka+One&family=Quicksand:wght@400;700&display=swap');

        :root {
            --bts-purple: #6d4aff;
            --bts-dark: #0a0518;
            --bts-vibrant: #bb86fc;
        }

        body {
            background-color: var(--bts-dark);
            font-family: 'Quicksand', sans-serif;
            color: white;
            overflow: hidden;
            margin: 0;
            height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            background-image: 
                radial-gradient(circle at 20% 30%, rgba(109, 74, 255, 0.15) 0%, transparent 40%),
                radial-gradient(circle at 80% 70%, rgba(187, 134, 252, 0.15) 0%, transparent 40%);
            touch-action: none;
        }

        .bts-font { font-family: 'Fredoka One', cursive; }

        .screen {
            position: absolute; width: 100%; height: 100%;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            z-index: 10;
        }

        .hidden { display: none !important; }

        .btn-bts {
            background: linear-gradient(to right, var(--bts-purple), var(--bts-vibrant));
            color: white; padding: 1rem 2rem; border-radius: 9999px;
            font-weight: bold; border-bottom: 6px solid #4a2cb3;
            transition: all 0.2s; box-shadow: 0 10px 30px rgba(109, 74, 255, 0.4);
            cursor: pointer; text-transform: uppercase;
        }

        .btn-bts:hover { transform: scale(1.05); }

        /* Estructura del Juego */
        .game-layout {
            display: flex; flex-direction: column; align-items: center; gap: 20px;
        }

        .puzzle-box {
            width: 88vw; height: 88vw;
            max-width: 450px; max-height: 450px;
            border: 4px solid var(--bts-purple);
            border-radius: 15px; overflow: hidden;
            background: #201540;
        }

        #puzzle-board {
            display: grid; gap: 1px; width: 100%; height: 100%;
            transition: gap 0.4s ease;
        }

        /* Estado Ganador: Se pegan las piezas */
        #puzzle-board.won { gap: 0; border: none; }

        .piece { cursor: pointer; background-repeat: no-repeat; transition: all 0.2s; }
        .piece.selected { outline: 4px solid white; outline-offset: -4px; z-index: 20; transform: scale(0.95); }
        .piece.locked { cursor: default; }

        /* Modal Vista Previa */
        #preview-modal {
            position: fixed; inset: 0; background: rgba(10, 5, 24, 0.9);
            backdrop-filter: blur(8px); z-index: 100;
            display: flex; align-items: center; justify-content: center;
        }

        .preview-content {
            position: relative; width: 85%; max-width: 400px;
            border: 4px solid var(--bts-purple); border-radius: 20px;
        }

        .close-btn {
            position: absolute; top: -15px; right: -15px;
            background: white; color: var(--bts-purple);
            width: 35px; height: 35px; border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
            font-weight: bold; border: 2px solid var(--bts-purple); cursor: pointer;
        }

        /* Decoraci√≥n */
        .floating-emoji { position: absolute; animation: float 5s infinite ease-in-out; z-index: 5; font-size: 2rem; pointer-events: none; }
        @keyframes float { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-20px); } }
        .star { position: absolute; background: white; border-radius: 50%; animation: twinkle 2s infinite; }
        @keyframes twinkle { 0%, 100% { opacity: 0.3; } 50% { opacity: 1; } }
    </style>
</head>
<body>

    <div id="star-container" class="fixed inset-0 pointer-events-none"></div>

    <div id="preview-modal" class="hidden" onclick="togglePreview(false)">
        <div class="preview-content" onclick="event.stopPropagation()">
            <div class="close-btn bts-font" onclick="togglePreview(false)">X</div>
            <img src="bts.jpg" class="w-full rounded-[16px]">
        </div>
    </div>

    <div id="screen-menu" class="screen">
        <div class="floating-emoji" style="top: 15%; left: 10%;">üíú</div>
        <div class="floating-emoji" style="top: 10%; right: 10%;">‚ú®</div>
        <div class="z-20 text-center">
            <h1 class="bts-font text-5xl mb-4">BTS: ARMY</h1>
            <div class="flex flex-col gap-4 max-w-[260px] mx-auto">
                <button onclick="configGame(25)" class="btn-bts bts-font text-xs">F√°cil (25)</button>
                <button onclick="configGame(49)" class="btn-bts bts-font text-xs">Medio (49)</button>
                <button onclick="configGame(100)" class="btn-bts bts-font text-xs">Experto (100)</button>
            </div>
        </div>
    </div>

    <div id="screen-game" class="screen hidden">
        <div class="game-layout">
            
            <div id="mission-panel" class="flex flex-col items-center">
                <h2 class="bts-font text-xl text-purple-400 mb-2">Panel ARMY</h2>
                <div class="flex items-center gap-4">
                    <div class="bg-white/5 px-6 py-2 rounded-full border border-purple-500/30">
                        <p class="text-[10px] font-bold uppercase">Piezas: <span id="correct-count" class="text-purple-400 text-lg">0</span> / <span id="total-label">0</span></p>
                    </div>
                    <button onclick="togglePreview(true)" class="bg-purple-600 p-2.5 rounded-full shadow-lg">üëÅÔ∏è</button>
                </div>
            </div>

            <div id="victory-msg" class="hidden text-center">
                <h3 class="bts-font text-3xl text-white drop-shadow-lg">¬°MISI√ìN CUMPLIDA! üíú</h3>
            </div>

            <div class="puzzle-box">
                <div id="puzzle-board"></div>
            </div>

            <div id="result-panel" class="hidden">
                <button onclick="location.reload()" class="btn-bts text-[10px] py-2 px-10">Volver a intentar üîÑ</button>
            </div>

            <p id="footer-tag" class="text-[9px] text-purple-400/40 uppercase tracking-[0.4em] font-bold">I Purple You ¬∑ BTS x ARMY</p>
        </div>
    </div>

    <script>
        const IMG_URL = 'bts.jpg';
        let currentTotal = 25, rows, cols, order = [], selectedPiece = null;

        function createStars() {
            const container = document.getElementById('star-container');
            for(let i=0; i<70; i++) {
                const star = document.createElement('div');
                star.className = 'star';
                const size = Math.random() * 2 + 1;
                star.style.width = size + 'px'; star.style.height = size + 'px';
                star.style.top = Math.random() * 100 + 'vh'; star.style.left = Math.random() * 100 + 'vw';
                container.appendChild(star);
            }
        }

        function togglePreview(show) {
            document.getElementById('preview-modal').classList.toggle('hidden', !show);
        }

        function configGame(num) {
            currentTotal = num;
            rows = Math.sqrt(num); cols = rows;
            document.getElementById('total-label').innerText = num;
            document.getElementById('screen-menu').classList.add('hidden');
            document.getElementById('screen-game').classList.remove('hidden');
            initGame();
        }

        function initGame() {
            order = [...Array(currentTotal).keys()];
            shuffle();
            renderBoard();
        }

        function renderBoard() {
            const board = document.getElementById('puzzle-board');
            board.style.gridTemplateColumns = `repeat(${cols}, 1fr)`;
            board.style.gridTemplateRows = `repeat(${rows}, 1fr)`;
            board.innerHTML = '';
            
            let correctOnes = 0;
            order.forEach((originalPos, currentIdx) => {
                const isCorrect = originalPos === currentIdx;
                if (isCorrect) correctOnes++;

                const piece = document.createElement('div');
                piece.className = 'piece' + (isCorrect ? ' locked' : '');
                piece.style.backgroundImage = `url('${IMG_URL}')`;
                
                const r = Math.floor(originalPos / cols);
                const c = originalPos % cols;
                piece.style.backgroundSize = `${cols * 100}% ${rows * 100}%`;
                piece.style.backgroundPosition = `${(c * 100) / (cols - 1)}% ${(r * 100) / (rows - 1)}%`;
                
                piece.onclick = () => {
                    if (isCorrect || board.classList.contains('won')) return;
                    if (!selectedPiece) {
                        selectedPiece = piece;
                        piece.classList.add('selected');
                    } else {
                        const idx1 = parseInt(selectedPiece.dataset.idx);
                        const idx2 = currentIdx;
                        [order[idx1], order[idx2]] = [order[idx2], order[idx1]];
                        selectedPiece.classList.remove('selected');
                        selectedPiece = null;
                        renderBoard();
                        checkWin();
                    }
                };
                piece.dataset.idx = currentIdx;
                board.appendChild(piece);
            });
            document.getElementById('correct-count').innerText = correctOnes;
        }

        function shuffle() {
            for (let i = order.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [order[i], order[j]] = [order[j], order[i]];
            }
            if(order.every((v, i) => v === i)) shuffle();
        }

        function checkWin() {
            if (order.every((v, i) => v === i)) {
                const board = document.getElementById('puzzle-board');
                board.classList.add('won');
                
                // Cambios en la interfaz al ganar
                document.getElementById('mission-panel').classList.add('hidden');
                document.getElementById('victory-msg').classList.remove('hidden');
                document.getElementById('result-panel').classList.remove('hidden');
                
                celebrate();
            }
        }

        function celebrate() {
            const icons = ['üíú', '‚ú®', 'üï∫'];
            for(let i=0; i<40; i++) {
                const c = document.createElement('div');
                c.className = 'fixed text-2xl z-50 pointer-events-none';
                c.innerHTML = icons[Math.floor(Math.random() * icons.length)];
                c.style.left = Math.random() * 100 + 'vw';
                c.style.top = '100vh';
                c.style.transition = `all ${Math.random() * 2 + 2}s linear`;
                document.body.appendChild(c);
                setTimeout(() => c.style.top = '-10vh', 50);
                setTimeout(() => c.remove(), 4000);
            }
        }

        window.onload = createStars;
    </script>
</body>
</html>
